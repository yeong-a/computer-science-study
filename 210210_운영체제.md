## ✔ 프로세스와 쓰레드

### 🔹 프로세스(Process)

- 운영체제로부터 자원을 할당받는 작업의 단위이다.
- 메모리에 올라와 실행되고 있는 프로그램의 인스턴스를 뜻한다.
- 하나의 프로세스는 4가지 영역으로 이루어져있다.
    - 코드 영역 : 코드 자체를 구성하는 메모리 영역(프로그램 명령)
    - 데이터 영역 : 전역 변수, 정적 변수, 배열 등(초기화된 데이터)
    - 스택 영역 : 지역 변수, 매개 변수, 리턴 값(임시 메모리 영역)
    - 힙 영역 : 동적 메모리 할당 시 사용(new(), malloc() 등)

### 🔹 스레드(Thread)

- 프로세스가 할당받은 자원을 이용하는 실행의 단위이다.
- 기본적으로 하나의 프로세스가 생성되면 하나의 스레드가 같이 생성되는데, 이것을 메인 스레드라고 한다. 스레드를 추가로 생성하지 않는 한 모든 프로그램 코드는 메인 스레드에서 실행된다.

### 🔹 멀티 프로세싱(Multi Processing)

하나의 응용 프로그램을 여러개의 프로세스로 구성하여 각 프로세스가 하나의 작업을 처리하도록 하는 것이다.

- 장점
    - 독립된 구조이기 때문에 안정성이 높다.
- 단점
    - CPU에서 여러 프로세스를 돌아가면서 작업을 처리하는 것을 Context Switching(문맥 교환)이라고 하는데, 이 과정에서 오버헤드가 발생해 성능저하가 일어난다.

### 🔹 멀티 스레딩(Multi Threading)

하나의 프로세스 내에서 둘 이상의 스레드가 동시에 작업을 진행하는 것이다.

- 장점
    - 프로세스에 자원을 할당하는 시스템 콜이 줄어들어 자원을 효율적으로 관리할 수 있다.
    - 스레드 사이의 작업량이 적어 Context Switching이 빠르고 데이터를 주고받는 것이 간단해 시스템 자원 소모가 줄어든다.
    - 스레드는 프로세스내의 스택 영역을 제외한 모든 영역을 공유하기 때문에 통신의 부담이 적다.
- 단점
    - 디버깅이 까다롭다.
    - 스레드 간의 자원 공유는 전역 변수인 데이터 세그먼트를 이용하기 때문에 동기화를 하지 않으면 문제가 발생할 수도 있다.
    - 하나의 스레드에 문제가 생기면 프로세스 전체가 영향을 받는다.

## ✔ 데드락(Dead Lock)

- Dead Lock(교착 상태)은 둘 이상의 프로세스들이 자원을 점유한 상태에서 서로 다른 프로세스가 점유하고 있는 자원을 요구하며 무한정 기다리는 현상이다.
- 멀티 프로그래밍 환경에서 한정된 자원을 사용하려고 할 때 발생한다.

### 🔹 데드락의 필요충분 조건 4가지

- 상호 배제(Mutual Exclusion) : 한 번에 한 개의 프로세스만이 공유 자원을 사용할 수 있어야 한다.
- 점유와 대기(Hold and Wait) : 최소한 하나의 자원을 점유하고 있으면서 다른 프로세스에 할당되어 사용되고 있는 자원을 추가로 점유하기 위해 대기하는 프로세스가 있어야한다.
- 비선점(Non-preemption) : 다른 프로세스에 할당된 자원은 사용이 끝날 떄까지 강제로 빼앗을 수 없어야 한다.
- 환형 대기(Circular Wait) : 공유 자원과 공유 자원을 사용하기 위해 대기하는 프로세스들이 원형으로 구성되어 있어 자신에게 할당된 자원을 점유하면서 앞이나 뒤에 있는 프로세스의 자원을 요구해야 한다.

### 🔹 데드락의 해결방법

### 예방 기법(Prevention)

데드락이 발생하지 않도록 사전에 시스템을 제어하는 방법으로, 교착상태 발생의 네 가지 조건 중에서 하나를 제거함으로써 수행된다. 자원의 낭비가 가장 심한 기법이다.

- 상호 배제(Mutual Exclusion) 부정 : 한 번에 여러 개의 프로세스가 공유 자원을 사용 할 수 있도록 한다.
- 점유 및 대기(Hold and Wait) 부정 : 프로세스가 실행되기 전 필요한 모든 자원을 할당하여 프로세스 대기를 없애거나 자원이 점유되지 않은 상태에서만 자원을 요구하도록 한다.
- 비선점(Non-preemption) 부정 : 자원을 점유하고 있는 프로세스가 다른 자원을 요구할 때 점유하고 있는 자원을 반납하고, 요구한 자원을 사용하기 위해 기다리게 한다.
- 환형 대기(Circular Wait) 부정 : 자원을 선형으로 분류하여 고유번호를 할당하고, 각 프로세스는 현재 점유한 자원의 고유 번호보다 앞이나 뒤 어느 한쪽 방향으로만 자원을 요구하도록 한다.

### 회피 기법(Avoidance)

데드락이 발생하면 적절히 피해나가는 방법이다.

- 은행원 알고리즘(Banker's Algorithm) : 은행에서 모든 고객의 요구가 충족되도록 현금을 할당하는 데에서 유래한 기법이다. 각 프로세스에게 자원을 할당하여 데드락이 발생하지 않으며 모든 프로세스가 완료될 수 있는 상태를 안정 상태, 데드락이 발생할 수 있는 상태를 불안정 상태라고 한다.

### 발견 기법(Detection)

시스템에 데드락이 발생했는지 점검하여 교착상태에 있는 프로세스와 자원을 발견하는 것을 의미한다.

### 회복 기법(Recovery)

데드락을 일으킨 프로세스를 종료하거나 데드락 상태의 프로세스에 할당된 자원을 선점하여 프로세스나 자원을 회복하는 기법이다.

- 프로세스 종료 : 데드락에 빠진 프로세스를 모두 종료하거나 하나씩 종료해가며 데드락을 해결한다.
- 자원 선점 : 데드락 상태인 프로세스가 점유하고 있는 자원을 선점하여 다른 프로세스에게 할당하며, 해당 프로세스를 일시 정지시킨다. 우선순위가 나은 프로세스, 수행된 정도가 적은 프로세스, 사용되는 자원이 적은 프로세스등을 위주로 해당 프로세스의 자원을 선점한다. 한 프로세스가 계속하여 자원 선점 대상이 되지 못하도록 고려해야 한다.

## ✔ 뮤텍스와 세마포어

- 뮤텍스와 세마포어는 모두 운영체제의 동기화 기법이다.
- 한정적인 자원에 여러 스레드가 동시에 접근하여 사용하면 문제가 발생할 수도 있는데, 이런 문제를 방지하기 위해 스레드들에게 하나의 자원에 대한 처리 권한을 주거나 순서를 조정해주는 방법이다.

### 🔹 뮤텍스

- MUTual EXclusion으로 상호배제라고도 한다.
- 스레드들의 실행시간을 겹치지 않게 단독으로 실행하게 하는 기법이다.
- 공유 자원에 접근을 조율하기 위해 Locking과 Unlocking을 사용한다.
- 뮤텍스 객체를 두개 이상의 스레드가 사용할 수 없다.

### 🔹 세마포어

- 세마포어는 스레드가 접근할 수 있는 공유자원의 수를 세마포어 변수 S로 나타내어 자원할당을 조절한다.
- 세마포어 Counter의 갯수에 따라 1개의 경우 Binary Semaphore, 2개 이상의 경우 Counting Semaphore라고 불린다.
- Binary Semaphore의 경우 개념적으로 Mutex와 같다고 볼 수 있다.

### 🔹 뮤텍스와 세마포어의 차이점

- 세마포어는 소유할 수 없지만 뮤텍스는 소유할 수 있다. 예시로, 뮤텍스를 소유하고 있는 스레드만 뮤텍스를 해제할 수 있지만, 세마포어는 소유하고 있지 않은 스레드가 세마포어를 해제할 수 있다.
- 뮤텍스는 상호배제를 함으로써 임계구역에 하나의 스레드만 들어갈 수 있지만, 세마포어는 하나의 스레드만 들어가게 할 수도 있고 여러개의 스레드가 들어가게 할 수도 있다. 따라서 뮤텍스는 동기화 대상이 하나 일 때, 세마포어는 여러개 일 때 사용한다.
- 세마포어는 시스템 범위에 걸쳐있고 파일 시스템 상의 파일 형태로 존재하지만, 뮤텍스는 프로세스 범위를 가지고 프로그램이 종료될 때 자동으로 삭제된다.

## ✔ CPU 스케쥴링

- cpu 스케쥴링이란 한정된 cpu 자원을 효율적으로 사용할 수 있게 os가 각 프로세서에 cpu자원을 할당하는 방법을 말한다.
- cpu 스케쥴링은 디스패쳐라고도 말하며, 주로 프로세서가 입/출력을 요할때, 높은 우선순위의 프로세서가 대기 큐에 나타났을 때, 프로세서가 할당된 cpu 이용시간을 초과했을 때 일어난다.
- 스케쥴링은 비선점형과 선점형으로 나뉘는데 비선점형 스케쥴링은 이미 할당된 CPU를 다른 프로세스가 강제로 빼앗아 사용할 수 없는 스케쥴링 기법이다.
- 선점형 스케쥴링은 하나의 프로세스가 CPU를 할당받아 실행하고 있을 때 우선순위가 높은 다른 프로세스가 CPU를 강제로 빼앗아 사용할 수 있는 스케쥴링 기법이다.

### 🔹 비선점형 스케쥴링

- FCFS(First Come First Service) : 대기 큐에 도착한 순서로 cpu를 할당하는 기법
- SJF(Shortest Job First) : 대기 큐에 기다리고 있는 프로세스들 중 실행시간이 가장 짧은 프로세스에게 cpu를 할당하는 방법
- HRN(Highest Response-ratio Nest) : 실행시간이 긴 프로세스에 불리한 SJF 기법을 보완한 방법으로, 대기시간과 실행시간을 이용하여 우선순위를 부여하는 기법. (대+서)/서

### 🔹 선점형 스케쥴링

- SRT(Shortest Remaining Time) : 비선점 스케쥴링인 SJF기법을 선점 형태로 변경한 기법으로, 선점 SJF 기법이라고도 함
- RR(Round Robin) : 시분할 시스템을 위해 고안된 방식으로, FCFS 기법과 같이 대기 큐에 먼저 들어온 프로세스가 먼저 CPU를 할당받지만 각 프로세스는 시간 할당량(Time Slice, Quantum) 동안만 실행한 후 다음 프로세스에세 CPU를 넘겨주고 자신은 다시 대기 큐의 마지막으로 배치된다.
- MQ(Multi-level Queue) : 프로세스를 특정 그루브로 분류할 수 있을 경우 그룹에 따라 각기 다른 대기 큐를 사용하는 기법
- MFQ(Multi-level Feedback Queue) : 특정 그룹의 대기 큐에 들어간 프로세스가 다른 대기 큐로 이동할 수 없는 MQ기법을 대기 큐 사이를 이동할 수 있도록 개선한 기법
    - 예를 들어, 어떤 프로세스가 타임 퀀텀을 모두 소진하지 못하고 입/출력 등으로 cpu를 자진 반납하면, 이 프로세스는 입/출력 성향이 강한것으로 판단하여 타임 퀀텀이 짧은 큐로 이동하게 된다. 반대로, 어떤 프로세스가 타임 퀀텀을 모두 소진하고 cpu를 강제로 반납하게 되면, 이 프로세스는 계산 성향이 강한 것으로 판단하여 타임 퀀텀이 긴 큐로 이동하게 된다.
